var i18n={setLanguage:function(t,e,n){return i18n.language=n,i18n.defaultLang=e||"en",i18n.supported=t||["en"],this},init:function(t,e,n){t=t||"resources/",e=e||"locale_",n=n||".json";var i=function(t,e){var n=window.navigator.userLanguage||window.navigator.language;return n=n.length>2?n.split("-")[0]:n,t.indexOf(n)>-1?n:e},a=function(t,e){if(null==t)try{JSON.parse(e.responseText),i18n._fail("Content is not defined")}catch(n){i18n._fail("Failed to parse the content",n)}else i18n.strings=t,i18n.localize()},r=pegasus(t+e+(i18n.language||i(i18n.supported,i18n.defaultLang))+n);r.then(a,i18n._fail)},_fail:function(t){console.error("[I18N]:"+t)},_jsonWalker:function(t,e){var n=e.split(".");return e=n.shift(),void 0==t||void 0==t[e]?(n.splice(0,0,e),"~~"+n.join(".")+"~~"):"object"==typeof t[e]&&n.length>0?this._jsonWalker(t[e],n.join(".")):t[e]},_isStringLocalized:function(t){function e(t){return("@"!==t[0]||"@"!==t[t.length-1])&&(/\s/.test(t)||t.indexOf("..")>-1||t.split(".").length<3)}return!t&&e(t)},localize:function(){if(!i18n.strings)throw"You must call the init method first";var t=function(t,e){if(e)try{e=e.replace("{",'{"').replace(":",'":').replace("}","}").replace(":'",':"').replace("'}",'"}'),e=JSON.parse(e)}catch(n){i18n._fail("Fail to parse context for "+t,n)}var i=libTranslate.getTranslationFunction({string:i18n._jsonWalker(i18n.strings,t.trim())});return i("string",void 0!=e?e:{})},e=function(e){if(e.indexOf("|i18n")>-1){var n=e.split("|");e=t(n[0],n.length>1?n[2]:null)}return e};Array.prototype.slice.call(document.getElementsByTagName("i18n")).map(function(e){i18n._isStringLocalized(e.textContent)||(e.textContent=t(e.textContent,e.attributes.context?e.attributes.context.value:null))}),Array.prototype.slice.call(document.getElementsByTagName("input")).map(function(t){t.placeholder=e(t.placeholder)}),Array.prototype.slice.call(document.getElementsByTagName("textarea")).map(function(t){t.placeholder=e(t.placeholder)}),Array.prototype.slice.call(document.getElementsByTagName("img")).map(function(t){t.alt=e(t.alt)}),Array.prototype.slice.call(document.getElementsByTagName("img")).map(function(t){t.title=e(t.title)}),Array.prototype.slice.call(document.getElementsByTagName("img")).filter(function(t){return void 0!==t.attributes["i18n-src"]}).map(function(t){t.src=e(t.attributes["i18n-src"].value)})}};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});